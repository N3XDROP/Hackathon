<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Subir y analizar (IA)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        max-width: 880px;
        margin: 24px auto;
        padding: 0 16px;
      }

      h1 {
        margin-bottom: 8px;
      }

      .msg {
        background: #f2f7ff;
        border: 1px solid #cfe2ff;
        padding: 10px 12px;
        border-radius: 8px;
      }

      .card {
        border: 1px solid #eee;
        border-radius: 10px;
        padding: 16px;
        margin-top: 16px;
      }

      .muted {
        color: #666;
      }

      code {
        background: #fafafa;
        padding: 2px 5px;
        border-radius: 4px;
      }

      ul {
        margin-top: 6px;
      }

      details {
        margin-top: 16px;
      }

      summary {
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h1>Subida y análisis con IA (Ollama multimodal)</h1>

    {% if mensaje %}
    <p class="msg"><em>{{ mensaje }}</em></p>
    {% endif %}

    <form
      action="/analizar"
      method="post"
      enctype="multipart/form-data"
      class="card"
    >
      <label>Descripción de la entidad (misión, visión, actividades TIC):</label
      ><br />
      <textarea name="descripcion_entidad"></textarea><br /><br />

      <label>Tipo de entidad (natural o jurídica):</label><br />
      <input type="text" name="tipo_entidad" /><br /><br />

      <label>Objeto social relacionado con TIC:</label><br />
      <input type="text" name="objeto_social" /><br /><br />

      <!-- Archivos requeridos -->
      <label>RUT actualizado:</label><br />
      <input type="file" name="rut" accept=".pdf,.png,.jpg,.jpeg" /><br /><br />

      <label>Certificado de Cámara de Comercio (vigente):</label><br />
      <input
        type="file"
        name="camara_comercio"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />

      <label>Cédula del representante legal:</label><br />
      <input
        type="file"
        name="cedula"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />

      <!-- Archivos firmados -->
      <label>Carta de Intención de Afiliación (firmada):</label><br />
      <input
        type="file"
        name="carta_intencion"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />

      <label
        >Carta de Aceptación de Estatutos, Reglamentos Internos y Políticas
        (firmada):</label
      ><br />
      <input
        type="file"
        name="carta_aceptacion"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />

      <!-- Antecedentes -->
      <label>Antecedentes del representante legal:</label><br />
      <input
        type="file"
        name="antecedentes_contraloria"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />
      <input
        type="file"
        name="antecedentes_procuraduria"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />
      <input
        type="file"
        name="antecedentes_policia"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />
      <input
        type="file"
        name="antecedentes_rnmc"
        accept=".pdf,.png,.jpg,.jpeg"
      /><br /><br />

      <!-- Composición laboral -->
      <label>Ubicación o composición laboral:</label><br />
      <input type="text" name="direccion_fisica" /><br /><br />
      <input type="text" name="residencia_boyaca" /><br /><br />

      <button type="submit">Analizar</button>
    </form>

    {% if ultimo %}
    <div class="card">
      <h2>Resultado reciente</h2>
      <p class="muted">
        Usuario: <strong>{{ ultimo.usuario_id }}</strong> · Estado:
        <strong>{{ ultimo.estado }}</strong> · Documentos completos:
        <strong>{{ 'Sí' if ultimo.completo else 'No' }}</strong>
      </p>

      {% if ultimo.faltan_documentos %}
      <p>
        <strong>Documentos faltantes:</strong> {{ ultimo.faltan_documentos |
        join(", ") }}
      </p>
      {% endif %}

      <!-- Resumen de la Cédula -->
      <h3>Resumen Cédula</h3>
      {% if ultimo.resultados.cedula %}
      <ul>
        <li><strong>NUIP:</strong> {{ ultimo.resultados.cedula.nuip }}</li>
        <li>
          <strong>Nombres:</strong> {{ ultimo.resultados.cedula.nombres }}
        </li>
        <li>
          <strong>Apellidos:</strong> {{ ultimo.resultados.cedula.apellidos }}
        </li>
        <li>
          <strong>Fecha de nacimiento:</strong> {{
          ultimo.resultados.cedula.fecha_nacimiento }}
        </li>
        <li>
          <strong>MRZ detectada:</strong> {{
          ultimo.resultados.cedula.mrz_detectada }}
        </li>
      </ul>
      {% else %}
      <p><em>No se cargó cédula.</em></p>
      {% endif %}

      <!-- Resumen del Certificado Médico -->
      <h3>Resumen Certificado Médico</h3>
      {% if ultimo.resultados.certificado %}
      <ul>
        <li>
          <strong>Tipo:</strong> {{
          ultimo.resultados.certificado.tipo_documento_detectado }}
        </li>
        <li>
          <strong>Nombre paciente:</strong> {{
          ultimo.resultados.certificado.nombre_paciente }}
        </li>
        <li>
          <strong>Fecha:</strong> {{ ultimo.resultados.certificado.fecha }}
        </li>
        <li>
          <strong>Resultado:</strong> {{ ultimo.resultados.certificado.resultado
          }}
        </li>
        <li>
          <strong>Médico:</strong> {{
          ultimo.resultados.certificado.nombre_medico }}
        </li>
        <li>
          <strong>Registro profesional:</strong> {{
          ultimo.resultados.certificado.registro_profesional }}
        </li>
      </ul>
      {% else %}
      <p><em>No se cargó certificado.</em></p>
      {% endif %}

      <!-- Otros documentos -->
      <h3>Otros documentos procesados</h3>
      <ul>
        <li>
          <strong>RUT:</strong> {{ ultimo.resultados.rut.nombre if
          ultimo.resultados.rut else 'No cargado' }}
        </li>
        <li>
          <strong>Contraloría:</strong> {{ ultimo.resultados.contraloria.nombre
          if ultimo.resultados.contraloria else 'No cargado' }}
        </li>
        <li>
          <strong>Procuraduría:</strong> {{
          ultimo.resultados.procuraduria.nombre if
          ultimo.resultados.procuraduria else 'No cargado' }}
        </li>
        <li>
          <strong>Policía:</strong> {{ ultimo.resultados.policia.nombre if
          ultimo.resultados.policia else 'No cargado' }}
        </li>
        <li>
          <strong>RNMC:</strong> {{ ultimo.resultados.rnmc.nombre if
          ultimo.resultados.rnmc else 'No cargado' }}
        </li>
        <li>
          <strong>Dirección física:</strong> {{ ultimo.direccion_fisica or "No
          proporcionado" }}
        </li>
        <li>
          <strong>Residencia Boyacá:</strong> {{ ultimo.residencia_boyaca or "No
          proporcionado" }}
        </li>
      </ul>

      <!-- JSON completo -->
      <details>
        <summary>Ver JSON completo devuelto por la IA</summary>
        <pre>{{ ultimo | tojson(indent=2) }}</pre>
      </details>
    </div>
    {% endif %}
  </body>
</html>